name: Daily Vala & GTK Optimization

on:
  schedule:
    - cron: '0 * * * *'  # Every hour
  workflow_dispatch:

jobs:
  refactor:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: google-labs-code/jules-invoke@v1
        with:
          prompt: |
            You are an expert Vala and GTK developer. Scan the codebase to flatten nested logic and optimize GObject performance.

            CRITICAL (fix immediately):
            - Deep Nesting: Flatten "arrow code" in signal handlers and callbacks using guard clauses (e.g., if (condition) return;) and early exits.
            - UI Thread Blocking: Identify long-running synchronous operations on the main thread and refactor them using 'async' and 'yield'.
            - Reference Cycles: Identify potential memory leaks in signals and closures; use 'unowned' references where necessary to break cycles.

            HIGH PRIORITY:
            - Signal Handling: Ensure signals are disconnected properly and use modern Vala signal syntax.
            - Object Construction: Optimize heavy GObject construction; suggest using Gtk.Builder templates where appropriate.
            - Iteration Performance: Optimize loops over GLib.List or GLib.SList, or suggest switching to Gee collections if performance warrants.

            Rules:
            - Simplify complex logic to improve readability.
            - Use idiomatic Vala (e.g., proper use of 'var', 'out' parameters, and ownership keywords).
            - Keep changes under 100 lines.
            - Ensure the UI logic remains stable and follows GTK best practices (GTK3/GTK4).
            - Run build/tests to ensure no regressions.
          jules_api_key: ${{ secrets.JULES_API_KEY }}
